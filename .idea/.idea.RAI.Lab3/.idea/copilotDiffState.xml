<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/RAI.Lab3.Application/Mapping/AvailabilityMapping.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/RAI.Lab3.Application/Mapping/AvailabilityMapping.cs" />
              <option name="originalContent" value="using NpgsqlTypes;&#10;using RAI.Lab3.Application.Dto;&#10;using RAI.Lab3.Application.Helpers;&#10;using RAI.Lab3.Domain.Models;&#10;&#10;namespace RAI.Lab3.Application.Mapping;&#10;&#10;public static class AvailabilityMapping&#10;{&#10;    public static TeacherAvailability MapFromDto(this TeacherAvailabilityCreateDto createDto, Guid teacherId)&#10;    {&#10;        var amountOfDays = createDto.EndDate.DayNumber - createDto.StartDate.DayNumber + 1;&#10;        var amountOfMinutes = (createDto.EndTime - createDto.StartTime).TotalMinutes;&#10;&#10;        var slotsInOneDay = amountOfMinutes / createDto.SlotDurationMinutes;&#10;&#10;        List&lt;NpgsqlRange&lt;DateTime&gt;&gt; slots = [];&#10;&#10;        for (var i = 0; i &lt; amountOfDays; i++)&#10;        {&#10;            var dateOnly = createDto.StartDate.AddDays(i);&#10;            for (var j = 0; j &lt; slotsInOneDay; j++)&#10;            {&#10;                var timeOnly = createDto.StartTime.AddMinutes(j * createDto.SlotDurationMinutes);&#10;&#10;                var dateTimeStart = dateOnly.ToDateTime(timeOnly);&#10;                var dateTimeEnd = dateTimeStart.AddMinutes(createDto.SlotDurationMinutes);&#10;&#10;                var dateTimeStartUtc = TimeZoneHelper.ToUtcFromZone(dateTimeStart);&#10;                var dateTimeEndUtc = TimeZoneHelper.ToUtcFromZone(dateTimeEnd);&#10;&#10;                var range = new NpgsqlRange&lt;DateTime&gt;(dateTimeStartUtc, true, dateTimeEndUtc, false);&#10;                slots.Add(range);&#10;            }&#10;        }&#10;&#10;        return new TeacherAvailability&#10;        {&#10;            RoomId = createDto.RoomId,&#10;            TeacherId = teacherId,&#10;            Periods = slots.ToArray(),&#10;            SlotDurationMinutes = createDto.SlotDurationMinutes&#10;        };&#10;    }&#10;&#10;    public static TeacherAvailabilityReadDto MapToReadDto(this TeacherAvailability availability)&#10;    {&#10;        var startDateTimeUtc = availability.Periods.Min(p =&gt; p.LowerBound);&#10;        var endDateTimeUtc = availability.Periods.Max(p =&gt; p.UpperBound);&#10;        &#10;        var startDateTime = TimeZoneHelper.ToZoneFromUtc(startDateTimeUtc);&#10;        var endDateTime = TimeZoneHelper.ToZoneFromUtc(endDateTimeUtc);&#10;        &#10;        return new TeacherAvailabilityReadDto&#10;        {&#10;            Id = availability.Id,&#10;            TeacherFullName = $&quot;{availability.Teacher.FirstName} {availability.Teacher.LastName}&quot;,&#10;            RoomName = availability.Room.Name,&#10;            StartDate = DateOnly.FromDateTime(startDateTime),&#10;            EndDate = DateOnly.FromDateTime(endDateTime),&#10;            StartTime = TimeOnly.FromDateTime(startDateTime),&#10;            EndTime = TimeOnly.FromDateTime(endDateTime),&#10;            Reservations = availability.Reservations&#10;                .Select(r =&gt; r.MapToReadDto())&#10;                .ToList()&#10;        };&#10;    }&#10;&#10;    public static List&lt;TeacherAvailabilityReadDto&gt; MapToReadDto(this List&lt;TeacherAvailability&gt; availability)&#10;    {&#10;        return availability.Select(a =&gt; a.MapToReadDto()).ToList();&#10;    }&#10;}" />
              <option name="updatedContent" value="using NpgsqlTypes;&#10;using RAI.Lab3.Application.Dto;&#10;using RAI.Lab3.Application.Helpers;&#10;using RAI.Lab3.Domain.Models;&#10;&#10;namespace RAI.Lab3.Application.Mapping;&#10;&#10;public static class AvailabilityMapping&#10;{&#10;    public static TeacherAvailability MapFromDto(this TeacherAvailabilityCreateDto createDto, Guid teacherId)&#10;    {&#10;        var amountOfDays = createDto.EndDate.DayNumber - createDto.StartDate.DayNumber + 1;&#10;        var amountOfMinutes = (createDto.EndTime - createDto.StartTime).TotalMinutes;&#10;&#10;        var slotsInOneDay = amountOfMinutes / createDto.SlotDurationMinutes;&#10;&#10;        List&lt;NpgsqlRange&lt;DateTime&gt;&gt; slots = [];&#10;&#10;        for (var i = 0; i &lt; amountOfDays; i++)&#10;        {&#10;            var dateOnly = createDto.StartDate.AddDays(i);&#10;            for (var j = 0; j &lt; slotsInOneDay; j++)&#10;            {&#10;                var timeOnly = createDto.StartTime.AddMinutes(j * createDto.SlotDurationMinutes);&#10;&#10;                var dateTimeStart = dateOnly.ToDateTime(timeOnly);&#10;                var dateTimeEnd = dateTimeStart.AddMinutes(createDto.SlotDurationMinutes);&#10;&#10;                var dateTimeStartUtc = TimeZoneHelper.ToUtcFromZone(dateTimeStart);&#10;                var dateTimeEndUtc = TimeZoneHelper.ToUtcFromZone(dateTimeEnd);&#10;&#10;                var range = new NpgsqlRange&lt;DateTime&gt;(dateTimeStartUtc, true, dateTimeEndUtc, false);&#10;                slots.Add(range);&#10;            }&#10;        }&#10;&#10;        return new TeacherAvailability&#10;        {&#10;            RoomId = createDto.RoomId,&#10;            TeacherId = teacherId,&#10;            Periods = slots.ToArray(),&#10;            SlotDurationMinutes = createDto.SlotDurationMinutes&#10;        };&#10;    }&#10;&#10;    public static TeacherAvailabilityReadDto MapToReadDto(this TeacherAvailability availability)&#10;    {&#10;        var startDateTimeUtc = availability.Periods.Min(p =&gt; p.LowerBound);&#10;        var endDateTimeUtc = availability.Periods.Max(p =&gt; p.UpperBound);&#10;        &#10;        var startDateTime = TimeZoneHelper.ToZoneFromUtc(startDateTimeUtc);&#10;        var endDateTime = TimeZoneHelper.ToZoneFromUtc(endDateTimeUtc);&#10;        &#10;        return new TeacherAvailabilityReadDto&#10;        {&#10;            Id = availability.Id,&#10;            TeacherFullName = $&quot;{availability.Teacher.FirstName} {availability.Teacher.LastName}&quot;,&#10;            RoomName = availability.Room.Name,&#10;            StartDate = DateOnly.FromDateTime(startDateTime),&#10;            EndDate = DateOnly.FromDateTime(endDateTime),&#10;            StartTime = TimeOnly.FromDateTime(startDateTime),&#10;            EndTime = TimeOnly.FromDateTime(endDateTime),&#10;            IsBlocked = availability.IsBlocked,&#10;            Reservations = availability.Reservations&#10;                .Select(r =&gt; r.MapToReadDto())&#10;                .ToList()&#10;        };&#10;    }&#10;&#10;    public static List&lt;TeacherAvailabilityReadDto&gt; MapToReadDto(this List&lt;TeacherAvailability&gt; availability)&#10;    {&#10;        return availability.Select(a =&gt; a.MapToReadDto()).ToList();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/RAI.Lab3.WebApp/Pages/DeclareAvailability.cshtml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/RAI.Lab3.WebApp/Pages/DeclareAvailability.cshtml" />
              <option name="originalContent" value="@page&#10;@model RAI.Lab3.WebApp.Pages.DeclareAvailability&#10;&#10;@{&#10;    ViewData[&quot;Title&quot;] = &quot;DeclareAvailability&quot;;&#10;}&#10;&#10;&lt;h1&gt;&#10;    Declare Availability&#10;&lt;/h1&gt;&#10;&#10;&lt;div class=&quot;row&quot;&gt;&#10;    &lt;div class=&quot;col&quot;&gt;&#10;        &lt;div class=&quot;card mb-4&quot;&gt;&#10;            &lt;div class=&quot;card-header&quot;&gt;&#10;                &lt;h5 class=&quot;card-title mb-0&quot;&gt;Declare availability&lt;/h5&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;card-body&quot;&gt;&#10;                &lt;form method=&quot;post&quot;&gt;&#10;                    &lt;div asp-validation-summary=&quot;ModelOnly&quot; class=&quot;text-danger&quot;&gt;&lt;/div&gt;&#10;&#10;                    &lt;div class=&quot;mb-3&quot;&gt;&#10;                        &lt;label asp-for=&quot;Input.RoomId&quot; class=&quot;form-label&quot;&gt;Room&lt;/label&gt;&#10;                        &lt;select asp-for=&quot;Input.RoomId&quot; asp-items=&quot;Model.AvailableRooms&quot; class=&quot;form-select&quot;&gt;&#10;                            &lt;option value=&quot;&quot;&gt;-- Select a Room --&lt;/option&gt;&#10;                        &lt;/select&gt;&#10;                        &lt;span asp-validation-for=&quot;Input.RoomId&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div class=&quot;row mb-3&quot;&gt;&#10;                        &lt;div class=&quot;col-md-6&quot;&gt;&#10;                            &lt;label asp-for=&quot;Input.StartDate&quot; class=&quot;form-label&quot;&gt;Start Date&lt;/label&gt;&#10;                            &lt;input asp-for=&quot;Input.StartDate&quot; type=&quot;date&quot; class=&quot;form-control&quot;/&gt;&#10;                            &lt;span asp-validation-for=&quot;Input.StartDate&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        &lt;div class=&quot;col-md-6&quot;&gt;&#10;                            &lt;label asp-for=&quot;Input.EndDate&quot; class=&quot;form-label&quot;&gt;End Date&lt;/label&gt;&#10;                            &lt;input asp-for=&quot;Input.EndDate&quot; type=&quot;date&quot; class=&quot;form-control&quot;/&gt;&#10;                            &lt;span asp-validation-for=&quot;Input.EndDate&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;&#10;                        &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div class=&quot;row mb-3&quot;&gt;&#10;                        &lt;div class=&quot;col-md-6&quot;&gt;&#10;                            &lt;label asp-for=&quot;Input.StartTime&quot; class=&quot;form-label&quot;&gt;Start Time&lt;/label&gt;&#10;                            &lt;input asp-for=&quot;Input.StartTime&quot; type=&quot;time&quot; class=&quot;form-control&quot;/&gt;&#10;                            &lt;span asp-validation-for=&quot;Input.StartTime&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        &lt;div class=&quot;col-md-6&quot;&gt;&#10;                            &lt;label asp-for=&quot;Input.EndTime&quot; class=&quot;form-label&quot;&gt;End Time&lt;/label&gt;&#10;                            &lt;input asp-for=&quot;Input.EndTime&quot; type=&quot;time&quot; class=&quot;form-control&quot;/&gt;&#10;                            &lt;span asp-validation-for=&quot;Input.EndTime&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;&#10;                        &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div class=&quot;mb-3&quot;&gt;&#10;                        &lt;label asp-for=&quot;Input.SlotDurationMinutes&quot; class=&quot;form-label&quot;&gt;Slot Duration (minutes)&lt;/label&gt;&#10;                        &lt;input asp-for=&quot;Input.SlotDurationMinutes&quot; type=&quot;number&quot; class=&quot;form-control&quot; min=&quot;1&quot; step=&quot;1&quot;/&gt;&#10;                        &lt;span asp-validation-for=&quot;Input.SlotDurationMinutes&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Declare Availability&lt;/button&gt;&#10;                &lt;/form&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&lt;/div&gt;&#10;&#10;&lt;div class=&quot;row&quot;&gt;&#10;    &lt;div class=&quot;col&quot;&gt;&#10;        @foreach (var availability in Model.ExistingAvailabilities)&#10;        {&#10;            &lt;div class=&quot;card mb-4&quot;&gt;&#10;                &lt;div class=&quot;card-header d-flex align-items-center&quot;&gt;&#10;                    &lt;h5 class=&quot;card-title mb-0 me-auto&quot;&gt;&#10;                        Room @availability.RoomName,&#10;                        from @availability.StartDate.ToString(&quot;dd.MM.yyyy&quot;) @availability.StartTime.ToString(),&#10;                        to @availability.EndDate.ToString(&quot;dd.MM.yyyy&quot;) @availability.EndTime.ToString().&#10;                    &lt;/h5&gt;&#10;                    &lt;div&gt;&#10;                        &lt;span class=&quot;badge text-bg-primary me-1&quot;&gt;@availability.Reservations.Count Total&lt;/span&gt;&#10;                        &lt;span class=&quot;badge text-bg-success me-1&quot;&gt;@availability.Reservations.Count(r =&gt; !r.IsReserved) Free&lt;/span&gt;&#10;                        &lt;span class=&quot;badge text-bg-info&quot;&gt;@availability.Reservations.Count(r =&gt; r.IsReserved) Taken&lt;/span&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;ms-2&quot;&gt;&#10;                        &lt;button type=&quot;button&quot; class=&quot;btn btn-sm btn-outline-warning&quot;&gt;&#10;                            Block period&#10;                        &lt;/button&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &lt;div class=&quot;card-body&quot;&gt;&#10;                    @{&#10;                        var accordionId = $&quot;accordion-{availability.Id}&quot;;&#10;                        var itemIndex = 0;&#10;                    }&#10;                    &lt;div class=&quot;accordion&quot; id=&quot;@accordionId&quot;&gt;&#10;                        @foreach (var slotsForDay in availability.Reservations&#10;                                          .GroupBy(r =&gt; DateOnly.FromDateTime(r.StartLocal))&#10;                                          .OrderBy(g =&gt; g.Key))&#10;                        {&#10;                            var collapseId = $&quot;collapse-{availability.Id}-{itemIndex}&quot;;&#10;                            itemIndex++;&#10;                            &lt;div class=&quot;accordion-item&quot;&gt;&#10;                                &lt;h2 class=&quot;accordion-header&quot;&gt;&#10;                                    &lt;button class=&quot;accordion-button collapsed&quot; type=&quot;button&quot; data-bs-toggle=&quot;collapse&quot;&#10;                                            data-bs-target=&quot;#@collapseId&quot;&#10;                                            aria-controls=&quot;@collapseId&quot;&gt;&#10;                                        &lt;span class=&quot;me-auto&quot;&gt;@slotsForDay.Key&lt;/span&gt;&#10;                                    &lt;/button&gt;&#10;                                &lt;/h2&gt;&#10;                                &lt;div id=&quot;@collapseId&quot; class=&quot;accordion-collapse collapse&quot;&#10;                                     data-bs-parent=&quot;#@accordionId&quot;&gt;&#10;                                    &lt;div class=&quot;accordion-body&quot;&gt;&#10;                                        &lt;table class=&quot;table table-striped&quot;&gt;&#10;                                            &lt;thead&gt;&#10;                                            &lt;th&gt;&#10;                                                Slot&#10;                                            &lt;/th&gt;&#10;                                            &lt;th&gt;Status&lt;/th&gt;&#10;                                            &lt;th&gt;Delete&lt;/th&gt;&#10;                                            &lt;/thead&gt;&#10;                                            &lt;tbody&gt;&#10;                                            @foreach (var slot in slotsForDay.OrderBy(r =&gt; r.StartLocal))&#10;                                            {&#10;                                                &lt;tr&gt;&#10;                                                    &lt;td&gt;@slot.StartLocal.TimeOfDay - @slot.EndLocal.TimeOfDay&lt;/td&gt;&#10;                                                    &lt;td&gt;&#10;                                                        @if (slot.IsReserved)&#10;                                                        {&#10;                                                            @($&quot;Taken by {slot.StudentFullName}&quot;)&#10;                                                        }&#10;                                                        else&#10;                                                        {&#10;                                                            &lt;em class=&quot;text-success&quot;&gt;Available&lt;/em&gt;&#10;                                                        }&#10;                                                    &lt;/td&gt;&#10;                                                    &lt;td&gt;&#10;                                                        &lt;form method=&quot;post&quot; asp-page-handler=&quot;DeleteSlot&quot; style=&quot;display: inline;&quot;&gt;&#10;                                                            &lt;input type=&quot;hidden&quot; name=&quot;slotId&quot; value=&quot;@slot.Id&quot; /&gt;&#10;                                                            &lt;button type=&quot;submit&quot; class=&quot;btn btn-outline-danger&quot;&gt;&#10;                                                                Delete&#10;                                                            &lt;/button&gt;&#10;                                                        &lt;/form&gt;&#10;                                                    &lt;/td&gt;&#10;                                                &lt;/tr&gt;&#10;                                            }&#10;                                            &lt;/tbody&gt;&#10;                                        &lt;/table&gt;&#10;                                    &lt;/div&gt;&#10;                                &lt;/div&gt;&#10;                            &lt;/div&gt;&#10;                        }&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        }&#10;    &lt;/div&gt;&#10;&lt;/div&gt;&#10;&#10;@section Scripts {&#10;    &lt;partial name=&quot;_ValidationScriptsPartial&quot;/&gt;&#10;    &lt;style&gt;&#10;        .accordion-button:focus {&#10;            box-shadow: none;&#10;            border-color: rgba(0,0,0,.125);&#10;        }&#10;    &lt;/style&gt;&#10;}&#10;" />
              <option name="updatedContent" value="@page&#10;@model RAI.Lab3.WebApp.Pages.DeclareAvailability&#10;&#10;@{&#10;    ViewData[&quot;Title&quot;] = &quot;DeclareAvailability&quot;;&#10;}&#10;&#10;&lt;h1&gt;&#10;    Declare Availability&#10;&lt;/h1&gt;&#10;&#10;&lt;div class=&quot;row&quot;&gt;&#10;    &lt;div class=&quot;col&quot;&gt;&#10;        &lt;div class=&quot;card mb-4&quot;&gt;&#10;            &lt;div class=&quot;card-header&quot;&gt;&#10;                &lt;h5 class=&quot;card-title mb-0&quot;&gt;Declare availability&lt;/h5&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;card-body&quot;&gt;&#10;                &lt;form method=&quot;post&quot;&gt;&#10;                    &lt;div asp-validation-summary=&quot;ModelOnly&quot; class=&quot;text-danger&quot;&gt;&lt;/div&gt;&#10;&#10;                    &lt;div class=&quot;mb-3&quot;&gt;&#10;                        &lt;label asp-for=&quot;Input.RoomId&quot; class=&quot;form-label&quot;&gt;Room&lt;/label&gt;&#10;                        &lt;select asp-for=&quot;Input.RoomId&quot; asp-items=&quot;Model.AvailableRooms&quot; class=&quot;form-select&quot;&gt;&#10;                            &lt;option value=&quot;&quot;&gt;-- Select a Room --&lt;/option&gt;&#10;                        &lt;/select&gt;&#10;                        &lt;span asp-validation-for=&quot;Input.RoomId&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div class=&quot;row mb-3&quot;&gt;&#10;                        &lt;div class=&quot;col-md-6&quot;&gt;&#10;                            &lt;label asp-for=&quot;Input.StartDate&quot; class=&quot;form-label&quot;&gt;Start Date&lt;/label&gt;&#10;                            &lt;input asp-for=&quot;Input.StartDate&quot; type=&quot;date&quot; class=&quot;form-control&quot;/&gt;&#10;                            &lt;span asp-validation-for=&quot;Input.StartDate&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        &lt;div class=&quot;col-md-6&quot;&gt;&#10;                            &lt;label asp-for=&quot;Input.EndDate&quot; class=&quot;form-label&quot;&gt;End Date&lt;/label&gt;&#10;                            &lt;input asp-for=&quot;Input.EndDate&quot; type=&quot;date&quot; class=&quot;form-control&quot;/&gt;&#10;                            &lt;span asp-validation-for=&quot;Input.EndDate&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;&#10;                        &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div class=&quot;row mb-3&quot;&gt;&#10;                        &lt;div class=&quot;col-md-6&quot;&gt;&#10;                            &lt;label asp-for=&quot;Input.StartTime&quot; class=&quot;form-label&quot;&gt;Start Time&lt;/label&gt;&#10;                            &lt;input asp-for=&quot;Input.StartTime&quot; type=&quot;time&quot; class=&quot;form-control&quot;/&gt;&#10;                            &lt;span asp-validation-for=&quot;Input.StartTime&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        &lt;div class=&quot;col-md-6&quot;&gt;&#10;                            &lt;label asp-for=&quot;Input.EndTime&quot; class=&quot;form-label&quot;&gt;End Time&lt;/label&gt;&#10;                            &lt;input asp-for=&quot;Input.EndTime&quot; type=&quot;time&quot; class=&quot;form-control&quot;/&gt;&#10;                            &lt;span asp-validation-for=&quot;Input.EndTime&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;&#10;                        &lt;/div&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div class=&quot;mb-3&quot;&gt;&#10;                        &lt;label asp-for=&quot;Input.SlotDurationMinutes&quot; class=&quot;form-label&quot;&gt;Slot Duration (minutes)&lt;/label&gt;&#10;                        &lt;input asp-for=&quot;Input.SlotDurationMinutes&quot; type=&quot;number&quot; class=&quot;form-control&quot; min=&quot;1&quot; step=&quot;1&quot;/&gt;&#10;                        &lt;span asp-validation-for=&quot;Input.SlotDurationMinutes&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Declare Availability&lt;/button&gt;&#10;                &lt;/form&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&lt;/div&gt;&#10;&#10;&lt;div class=&quot;row&quot;&gt;&#10;    &lt;div class=&quot;col&quot;&gt;&#10;        @foreach (var availability in Model.ExistingAvailabilities)&#10;        {&#10;            &lt;div class=&quot;card mb-4&quot;&gt;&#10;                &lt;div class=&quot;card-header d-flex align-items-center&quot;&gt;&#10;                    &lt;h5 class=&quot;card-title mb-0 me-auto&quot;&gt;&#10;                        Room @availability.RoomName,&#10;                        from @availability.StartDate.ToString(&quot;dd.MM.yyyy&quot;) @availability.StartTime.ToString(),&#10;                        to @availability.EndDate.ToString(&quot;dd.MM.yyyy&quot;) @availability.EndTime.ToString().&#10;                    &lt;/h5&gt;&#10;                    &lt;div&gt;&#10;                        &lt;span class=&quot;badge text-bg-primary me-1&quot;&gt;@availability.Reservations.Count Total&lt;/span&gt;&#10;                        &lt;span class=&quot;badge text-bg-success me-1&quot;&gt;@availability.Reservations.Count(r =&gt; !r.IsReserved) Free&lt;/span&gt;&#10;                        &lt;span class=&quot;badge text-bg-info&quot;&gt;@availability.Reservations.Count(r =&gt; r.IsReserved) Taken&lt;/span&gt;&#10;                        @if (availability.IsBlocked)&#10;                        {&#10;                            &lt;span class=&quot;badge text-bg-danger ms-1&quot;&gt;Blocked&lt;/span&gt;&#10;                        }&#10;                    &lt;/div&gt;&#10;                    &lt;div class=&quot;ms-2&quot;&gt;&#10;                        @if (availability.IsBlocked)&#10;                        {&#10;                            &lt;form method=&quot;post&quot; asp-page-handler=&quot;UnblockAvailability&quot; style=&quot;display: inline;&quot;&gt;&#10;                                &lt;input type=&quot;hidden&quot; name=&quot;availabilityId&quot; value=&quot;@availability.Id&quot; /&gt;&#10;                                &lt;button type=&quot;submit&quot; class=&quot;btn btn-sm btn-outline-success&quot;&gt;&#10;                                    Unblock period&#10;                                &lt;/button&gt;&#10;                            &lt;/form&gt;&#10;                        }&#10;                        else&#10;                        {&#10;                            &lt;form method=&quot;post&quot; asp-page-handler=&quot;BlockAvailability&quot; style=&quot;display: inline;&quot;&gt;&#10;                                &lt;input type=&quot;hidden&quot; name=&quot;availabilityId&quot; value=&quot;@availability.Id&quot; /&gt;&#10;                                &lt;button type=&quot;submit&quot; class=&quot;btn btn-sm btn-outline-warning&quot;&gt;&#10;                                    Block period&#10;                                &lt;/button&gt;&#10;                            &lt;/form&gt;&#10;                        }&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &lt;div class=&quot;card-body&quot;&gt;&#10;                    @{&#10;                        var accordionId = $&quot;accordion-{availability.Id}&quot;;&#10;                        var itemIndex = 0;&#10;                    }&#10;                    &lt;div class=&quot;accordion&quot; id=&quot;@accordionId&quot;&gt;&#10;                        @foreach (var slotsForDay in availability.Reservations&#10;                                          .GroupBy(r =&gt; DateOnly.FromDateTime(r.StartLocal))&#10;                                          .OrderBy(g =&gt; g.Key))&#10;                        {&#10;                            var collapseId = $&quot;collapse-{availability.Id}-{itemIndex}&quot;;&#10;                            itemIndex++;&#10;                            &lt;div class=&quot;accordion-item&quot;&gt;&#10;                                &lt;h2 class=&quot;accordion-header&quot;&gt;&#10;                                    &lt;button class=&quot;accordion-button collapsed&quot; type=&quot;button&quot; data-bs-toggle=&quot;collapse&quot;&#10;                                            data-bs-target=&quot;#@collapseId&quot;&#10;                                            aria-controls=&quot;@collapseId&quot;&gt;&#10;                                        &lt;span class=&quot;me-auto&quot;&gt;@slotsForDay.Key&lt;/span&gt;&#10;                                    &lt;/button&gt;&#10;                                &lt;/h2&gt;&#10;                                &lt;div id=&quot;@collapseId&quot; class=&quot;accordion-collapse collapse&quot;&#10;                                     data-bs-parent=&quot;#@accordionId&quot;&gt;&#10;                                    &lt;div class=&quot;accordion-body&quot;&gt;&#10;                                        &lt;table class=&quot;table table-striped&quot;&gt;&#10;                                            &lt;thead&gt;&#10;                                            &lt;th&gt;&#10;                                                Slot&#10;                                            &lt;/th&gt;&#10;                                            &lt;th&gt;Status&lt;/th&gt;&#10;                                            &lt;th&gt;Delete&lt;/th&gt;&#10;                                            &lt;/thead&gt;&#10;                                            &lt;tbody&gt;&#10;                                            @foreach (var slot in slotsForDay.OrderBy(r =&gt; r.StartLocal))&#10;                                            {&#10;                                                &lt;tr&gt;&#10;                                                    &lt;td&gt;@slot.StartLocal.TimeOfDay - @slot.EndLocal.TimeOfDay&lt;/td&gt;&#10;                                                    &lt;td&gt;&#10;                                                        @if (slot.IsReserved)&#10;                                                        {&#10;                                                            @($&quot;Taken by {slot.StudentFullName}&quot;)&#10;                                                        }&#10;                                                        else&#10;                                                        {&#10;                                                            &lt;em class=&quot;text-success&quot;&gt;Available&lt;/em&gt;&#10;                                                        }&#10;                                                    &lt;/td&gt;&#10;                                                    &lt;td&gt;&#10;                                                        &lt;form method=&quot;post&quot; asp-page-handler=&quot;DeleteSlot&quot; style=&quot;display: inline;&quot;&gt;&#10;                                                            &lt;input type=&quot;hidden&quot; name=&quot;slotId&quot; value=&quot;@slot.Id&quot; /&gt;&#10;                                                            &lt;button type=&quot;submit&quot; class=&quot;btn btn-outline-danger&quot;&gt;&#10;                                                                Delete&#10;                                                            &lt;/button&gt;&#10;                                                        &lt;/form&gt;&#10;                                                    &lt;/td&gt;&#10;                                                &lt;/tr&gt;&#10;                                            }&#10;                                            &lt;/tbody&gt;&#10;                                        &lt;/table&gt;&#10;                                    &lt;/div&gt;&#10;                                &lt;/div&gt;&#10;                            &lt;/div&gt;&#10;                        }&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        }&#10;    &lt;/div&gt;&#10;&lt;/div&gt;&#10;&#10;@section Scripts {&#10;    &lt;partial name=&quot;_ValidationScriptsPartial&quot;/&gt;&#10;    &lt;style&gt;&#10;        .accordion-button:focus {&#10;            box-shadow: none;&#10;            border-color: rgba(0,0,0,.125);&#10;        }&#10;    &lt;/style&gt;&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>