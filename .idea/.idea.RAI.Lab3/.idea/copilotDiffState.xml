<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/RAI.Lab3.Application/Mapping/AvailabilityMapping.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/RAI.Lab3.Application/Mapping/AvailabilityMapping.cs" />
              <option name="originalContent" value="using NpgsqlTypes;&#10;using RAI.Lab3.Application.Dto;&#10;using RAI.Lab3.Application.Helpers;&#10;using RAI.Lab3.Domain.Models;&#10;&#10;namespace RAI.Lab3.Application.Mapping;&#10;&#10;public static class AvailabilityMapping&#10;{&#10;    public static TeacherAvailability MapFromDto(this TeacherAvailabilityCreateDto createDto, Guid teacherId)&#10;    {&#10;        var amountOfDays = createDto.EndDate.DayNumber - createDto.StartDate.DayNumber + 1;&#10;        var amountOfMinutes = (createDto.EndTime - createDto.StartTime).TotalMinutes;&#10;&#10;        var slotsInOneDay = amountOfMinutes / createDto.SlotDurationMinutes;&#10;&#10;        List&lt;NpgsqlRange&lt;DateTime&gt;&gt; slots = [];&#10;&#10;        for (var i = 0; i &lt; amountOfDays; i++)&#10;        {&#10;            var dateOnly = createDto.StartDate.AddDays(i);&#10;            for (var j = 0; j &lt; slotsInOneDay; j++)&#10;            {&#10;                var timeOnly = createDto.StartTime.AddMinutes(j * createDto.SlotDurationMinutes);&#10;&#10;                var dateTimeStart = dateOnly.ToDateTime(timeOnly);&#10;                var dateTimeEnd = dateTimeStart.AddMinutes(createDto.SlotDurationMinutes);&#10;&#10;                var dateTimeStartUtc = TimeZoneHelper.ToUtcFromZone(dateTimeStart);&#10;                var dateTimeEndUtc = TimeZoneHelper.ToUtcFromZone(dateTimeEnd);&#10;&#10;                var range = new NpgsqlRange&lt;DateTime&gt;(dateTimeStartUtc, true, dateTimeEndUtc, false);&#10;                slots.Add(range);&#10;            }&#10;        }&#10;&#10;        return new TeacherAvailability&#10;        {&#10;            RoomId = createDto.RoomId,&#10;            TeacherId = teacherId,&#10;            Periods = slots.ToArray(),&#10;            SlotDurationMinutes = createDto.SlotDurationMinutes&#10;        };&#10;    }&#10;&#10;    public static TeacherAvailabilityReadDto MapToReadDto(this TeacherAvailability availability)&#10;    {&#10;        var startDateTimeUtc = availability.Periods.Min(p =&gt; p.LowerBound);&#10;        var endDateTimeUtc = availability.Periods.Max(p =&gt; p.UpperBound);&#10;        &#10;        var startDateTime = TimeZoneHelper.ToZoneFromUtc(startDateTimeUtc);&#10;        var endDateTime = TimeZoneHelper.ToZoneFromUtc(endDateTimeUtc);&#10;        &#10;        return new TeacherAvailabilityReadDto&#10;        {&#10;            Id = availability.Id,&#10;            TeacherFullName = $&quot;{availability.Teacher.FirstName} {availability.Teacher.LastName}&quot;,&#10;            RoomName = availability.Room.Name,&#10;            StartDate = DateOnly.FromDateTime(startDateTime),&#10;            EndDate = DateOnly.FromDateTime(endDateTime),&#10;            StartTime = TimeOnly.FromDateTime(startDateTime),&#10;            EndTime = TimeOnly.FromDateTime(endDateTime),&#10;            Reservations = availability.Reservations&#10;                .Select(r =&gt; r.MapToReadDto())&#10;                .ToList()&#10;        };&#10;    }&#10;&#10;    public static List&lt;TeacherAvailabilityReadDto&gt; MapToReadDto(this List&lt;TeacherAvailability&gt; availability)&#10;    {&#10;        return availability.Select(a =&gt; a.MapToReadDto()).ToList();&#10;    }&#10;}" />
              <option name="updatedContent" value="using NpgsqlTypes;&#10;using RAI.Lab3.Application.Dto;&#10;using RAI.Lab3.Application.Helpers;&#10;using RAI.Lab3.Domain.Models;&#10;&#10;namespace RAI.Lab3.Application.Mapping;&#10;&#10;public static class AvailabilityMapping&#10;{&#10;    public static TeacherAvailability MapFromDto(this TeacherAvailabilityCreateDto createDto, Guid teacherId)&#10;    {&#10;        var amountOfDays = createDto.EndDate.DayNumber - createDto.StartDate.DayNumber + 1;&#10;        var amountOfMinutes = (createDto.EndTime - createDto.StartTime).TotalMinutes;&#10;&#10;        var slotsInOneDay = amountOfMinutes / createDto.SlotDurationMinutes;&#10;&#10;        List&lt;NpgsqlRange&lt;DateTime&gt;&gt; slots = [];&#10;&#10;        for (var i = 0; i &lt; amountOfDays; i++)&#10;        {&#10;            var dateOnly = createDto.StartDate.AddDays(i);&#10;            for (var j = 0; j &lt; slotsInOneDay; j++)&#10;            {&#10;                var timeOnly = createDto.StartTime.AddMinutes(j * createDto.SlotDurationMinutes);&#10;&#10;                var dateTimeStart = dateOnly.ToDateTime(timeOnly);&#10;                var dateTimeEnd = dateTimeStart.AddMinutes(createDto.SlotDurationMinutes);&#10;&#10;                var dateTimeStartUtc = TimeZoneHelper.ToUtcFromZone(dateTimeStart);&#10;                var dateTimeEndUtc = TimeZoneHelper.ToUtcFromZone(dateTimeEnd);&#10;&#10;                var range = new NpgsqlRange&lt;DateTime&gt;(dateTimeStartUtc, true, dateTimeEndUtc, false);&#10;                slots.Add(range);&#10;            }&#10;        }&#10;&#10;        return new TeacherAvailability&#10;        {&#10;            RoomId = createDto.RoomId,&#10;            TeacherId = teacherId,&#10;            Periods = slots.ToArray(),&#10;            SlotDurationMinutes = createDto.SlotDurationMinutes&#10;        };&#10;    }&#10;&#10;    public static TeacherAvailabilityReadDto MapToReadDto(this TeacherAvailability availability)&#10;    {&#10;        var startDateTimeUtc = availability.Periods.Min(p =&gt; p.LowerBound);&#10;        var endDateTimeUtc = availability.Periods.Max(p =&gt; p.UpperBound);&#10;        &#10;        var startDateTime = TimeZoneHelper.ToZoneFromUtc(startDateTimeUtc);&#10;        var endDateTime = TimeZoneHelper.ToZoneFromUtc(endDateTimeUtc);&#10;        &#10;        return new TeacherAvailabilityReadDto&#10;        {&#10;            Id = availability.Id,&#10;            TeacherFullName = $&quot;{availability.Teacher.FirstName} {availability.Teacher.LastName}&quot;,&#10;            RoomName = availability.Room.Name,&#10;            StartDate = DateOnly.FromDateTime(startDateTime),&#10;            EndDate = DateOnly.FromDateTime(endDateTime),&#10;            StartTime = TimeOnly.FromDateTime(startDateTime),&#10;            EndTime = TimeOnly.FromDateTime(endDateTime),&#10;            IsBlocked = availability.IsBlocked,&#10;            Reservations = availability.Reservations&#10;                .Select(r =&gt; r.MapToReadDto())&#10;                .ToList()&#10;        };&#10;    }&#10;&#10;    public static List&lt;TeacherAvailabilityReadDto&gt; MapToReadDto(this List&lt;TeacherAvailability&gt; availability)&#10;    {&#10;        return availability.Select(a =&gt; a.MapToReadDto()).ToList();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>